name: Weekly Scraper & Auto-Fix

on:
  schedule:
    # Her Pazartesi Sabah 09:00'da Ã§alÄ±ÅŸÄ±r (UTC saatine gÃ¶re 06:00)
    - cron: '0 6 * * 1'
  # Manuel tetiklemek isterseniz 'Run workflow' butonu iÃ§in:
  workflow_dispatch:

jobs:
  scrape-and-fix:
    runs-on: ubuntu-latest
    
    # Maksimum Ã§alÄ±ÅŸma sÃ¼resi (Dakika). 
    # 5000 kampanya iÃ§in artÄ±rÄ±labilir, ÅŸimdilik 360 (6 saat) yeterli.
    timeout-minutes: 360

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: ðŸš€ Run WorldCard Scraper (Auto-Clean included)
        run: npx ts-node src/scrapers/worldcard.ts --ai
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      # Gelecekte diÄŸer bankalarÄ± buraya ekleyebilirsiniz
      # - name: ðŸš€ Run Maximum Scraper
      #   run: npx ts-node src/scrapers/maximum.ts --ai

      - name: ðŸ”§ Run Auto-Fix Pipeline (Maintenance)
        # TÃ¼m veritabanÄ±nÄ± tarar ve eksikleri tamamlar
        run: npx ts-node src/qualityPipeline.ts --autofix
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
